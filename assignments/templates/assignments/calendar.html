<!-- templates/myapp/assignment_list.html -->
{% extends 'base.html' %} 

{% block content %}
<div class="container mt-5">
  <h1>Calendar</h1>

  <body>
    <div class="calendar-container">
      <div class="row">
        <div class="col-md-12">
          <!-- View Toggle -->
          <div class="mb-3">
            <div class="btn-group" role="group">
              <button class="btn btn-outline-primary active" id="monthView">Month View</button>
              <button class="btn btn-outline-primary" id="weekView">Week View</button>
            </div>
          </div>

          <!-- Calendar Navigation -->
          <div class="d-flex justify-content-between align-items-center mb-4">
            <button class="btn btn-outline-primary" id="prevBtn">&lt; Previous</button>
            <h3 class="calendar-month-year mb-0" id="currentPeriod"></h3>
            <button class="btn btn-outline-primary" id="nextBtn">Next &gt;</button>
          </div>

          <!-- Calendar Grid -->
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>Sun</th>
                <th>Mon</th>
                <th>Tue</th>
                <th>Wed</th>
                <th>Thu</th>
                <th>Fri</th>
                <th>Sat</th>
              </tr>
            </thead>
            <tbody id="calendarBody">
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <script>
      class Calendar {
        constructor() {
          this.date = new Date();
          this.currentMonth = this.date.getMonth();
          this.currentYear = this.date.getFullYear();
          this.currentWeek = this.getWeekNumber(this.date);
          this.isMonthView = true;
          this.periodElement = document.getElementById('currentPeriod');
          this.calendarBody = document.getElementById('calendarBody');
          
          this.initializeCalendar();
          this.addEventListeners();
        }

        getWeekNumber(date) {
          const firstDayOfYear = new Date(date.getFullYear(), 0, 1);
          const pastDaysOfYear = (date - firstDayOfYear) / 86400000;
          return Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7);
        }

        initializeCalendar() {
          this.showCalendar();
        }

        addEventListeners() {
          document.getElementById('prevBtn').addEventListener('click', () => {
            if (this.isMonthView) {
              this.currentYear = (this.currentMonth === 0) ? this.currentYear - 1 : this.currentYear;
              this.currentMonth = (this.currentMonth === 0) ? 11 : this.currentMonth - 1;
            } else {
              const prevWeek = new Date(this.date);
              prevWeek.setDate(prevWeek.getDate() - 7);
              this.date = prevWeek;
              this.currentWeek = this.getWeekNumber(this.date);
              this.currentMonth = this.date.getMonth();
              this.currentYear = this.date.getFullYear();
            }
            this.showCalendar();
          });

          document.getElementById('nextBtn').addEventListener('click', () => {
            if (this.isMonthView) {
              this.currentYear = (this.currentMonth === 11) ? this.currentYear + 1 : this.currentYear;
              this.currentMonth = (this.currentMonth + 1) % 12;
            } else {
              const nextWeek = new Date(this.date);
              nextWeek.setDate(nextWeek.getDate() + 7);
              this.date = nextWeek;
              this.currentWeek = this.getWeekNumber(this.date);
              this.currentMonth = this.date.getMonth();
              this.currentYear = this.date.getFullYear();
            }
            this.showCalendar();
          });

          document.getElementById('monthView').addEventListener('click', (e) => {
            if (!this.isMonthView) {
              this.isMonthView = true;
              e.target.classList.add('active');
              document.getElementById('weekView').classList.remove('active');
              this.showCalendar();
            }
          });

          document.getElementById('weekView').addEventListener('click', (e) => {
            if (this.isMonthView) {
              this.isMonthView = false;
              e.target.classList.add('active');
              document.getElementById('monthView').classList.remove('active');
              this.showCalendar();
            }
          });
        }

        showCalendar() {
          if (this.isMonthView) {
            this.showMonthView();
          } else {
            this.showWeekView();
          }
        }

        showMonthView() {
          const firstDay = new Date(this.currentYear, this.currentMonth, 1).getDay();
          const daysInMonth = new Date(this.currentYear, this.currentMonth + 1, 0).getDate();
          const months = ["January", "February", "March", "April", "May", "June",
                         "July", "August", "September", "October", "November", "December"];

          this.periodElement.innerHTML = `${months[this.currentMonth]} ${this.currentYear}`;
          this.calendarBody.innerHTML = '';

          let date = 1;
          for (let i = 0; i < 6; i++) {
            const row = document.createElement('tr');
            
            for (let j = 0; j < 7; j++) {
              const cell = document.createElement('td');
              cell.classList.add('calendar-day');
              
              if (i === 0 && j < firstDay) {
                cell.innerHTML = "";
              } else if (date > daysInMonth) {
                break;
              } else {
                cell.innerHTML = date;
                if (date === new Date().getDate() && 
                    this.currentYear === new Date().getFullYear() && 
                    this.currentMonth === new Date().getMonth()) {
                  cell.classList.add('bg-primary', 'text-white');
                }
                date++;
              }
              row.appendChild(cell);
            }
            this.calendarBody.appendChild(row);
          }
        }

        showWeekView() {
          const startOfWeek = new Date(this.date);
          startOfWeek.setDate(this.date.getDate() - this.date.getDay());
          
          const months = ["January", "February", "March", "April", "May", "June",
                         "July", "August", "September", "October", "November", "December"];

          this.periodElement.innerHTML = `${months[this.currentMonth]} ${this.currentYear}`;
          this.calendarBody.innerHTML = '';

          const row = document.createElement('tr');
          for (let i = 0; i < 7; i++) {
            const currentDate = new Date(startOfWeek);
            currentDate.setDate(startOfWeek.getDate() + i);
            
            const cell = document.createElement('td');
            cell.classList.add('calendar-day');
            cell.innerHTML = currentDate.getDate();
            
            if (currentDate.toDateString() === new Date().toDateString()) {
              cell.classList.add('bg-primary', 'text-white');
            }
            
            row.appendChild(cell);
          }
          this.calendarBody.appendChild(row);
        }
      }

      document.addEventListener('DOMContentLoaded', () => {
        new Calendar();
      });
    </script>

    <style>
      .calendar-container {
        max-width: 800px;
        margin: 0 auto;
      }
      .calendar-day {
        height: 80px;
        vertical-align: top;
        padding: 8px;
      }
      .calendar-month-year {
        font-size: 1.5rem;
        font-weight: bold;
      }
    </style>
  
  </body>
</div>

<style>
</style>
{% endblock %}