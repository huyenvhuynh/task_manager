<!-- templates/myapp/edit_assignment.html -->
{% extends 'myapp/base.html' %} {% block title %}{% endblock %}
{% block content %}
<div class="container mt-5">
  <h1>Edit Assignment</h1>
  <form
    action="{% url 'myapp:edit_assignment' assignment.id %}"
    method="post"
    enctype="multipart/form-data"
  >
    {% csrf_token %}
    <div class="mb-3">
      <label for="title" class="form-label">Title</label>
      <input
        type="text"
        class="form-control"
        id="title"
        name="title"
        value="{{ assignment.title }}"
        required
      />
    </div>
    <div class="mb-3">
      <label for="description" class="form-label">Description</label>
      <textarea
        class="form-control"
        id="description"
        name="description"
        rows="3"
        required
      >
{{ assignment.description }}</textarea
      >
    </div>
    <div class="mb-3">
      <label for="due_date" class="form-label">Due Date</label>
      <input
        type="date"
        class="form-control"
        id="due_date"
        name="due_date"
        value="{{ assignment.due_date }}"
        required
      />
    </div>

    
    <!-- Adding keywords -->
    <!-- <div class="mb-3">
      <label for="keywords" class="form-label">Keywords</label>
      <div class="tags-input-container">
        <input
          type="text"
          class="form-control"
          id="keywords-input"
          placeholder="Add a keyword and press comma"
          onkeydown="addTag(event)"
        />
      </div>
      <div id="tagsDisplay" class="tags-display"></div>
      <input
        type="hidden"
        name="keywords"
        id="keywords"
        value="{{ assignment.keywords }}"
      />
    </div> -->

    {% if assignment.file_upload %}
    <div class="mb-3">
      <label class="form-label">Current File</label>
      <p>
        <a href="{{ assignment.file_upload.url }}"
          >{{ assignment.file_upload.name }}</a
        >
      </p>
    </div>

    <div class="mb-3">
      <label for="file_upload" class="form-label">Replace File</label>
      <input
        type="file"
        class="form-control"
        id="file_upload"
        name="file_upload"
      />
    </div>

      <!-- File Metadata section -->
      <div class="mb-3">
        <h4>File Metadata</h4>
        {% if assignment.file_title %}
          <p>Title: {{ assignment.file_title }}</p>
        {% endif %}
        {% if assignment.file_description %}
          <p>Description: {{ assignment.file_description }}</p>
        {% endif %}
        {% if assignment.keywords %}
          <p>Keywords: {{ assignment.keywords }}</p>
        {% endif %}
      </div>
      {% endif %}

    <button type="submit" class="btn btn-primary">Save Changes</button>
  </form>
  <a href="{% url 'myapp:assignment_list' %}" class="btn btn-secondary mt-3"
    >Back to Assignments</a
  >
</div>
{% endblock %}

<script>
  function addTag(event) {
    const input = document.getElementById("keywords-input");
    const tagsDisplay = document.getElementById("tagsDisplay");
    const hiddenInput = document.getElementById("keywords");

    if (event.key === ",") {
      event.preventDefault();
      let tag = input.value.trim().replace(",", "");
      if (tag) {
        // Create a new tag element
        const tagElement = document.createElement("span");
        tagElement.className = "tag";
        tagElement.textContent = tag;

        // Add a delete button for the tag
        const deleteButton = document.createElement("span");
        deleteButton.className = "tag-delete";
        deleteButton.textContent = " x";
        deleteButton.onclick = function () {
          tagsDisplay.removeChild(tagElement);
          updateHiddenInput();
        };

        tagElement.appendChild(deleteButton);
        tagsDisplay.appendChild(tagElement);

        // Clear input and update hidden input with tags
        input.value = "";
        updateHiddenInput();
      }
    }
  }

  function updateHiddenInput() {
    const tagsDisplay = document.getElementById("tagsDisplay");
    const hiddenInput = document.getElementById("keywords");

    let tags = Array.from(tagsDisplay.getElementsByClassName("tag")).map(
      (tag) => tag.textContent.replace(" x", "").trim()
    );

    hiddenInput.value = tags.join(",");
  }

  // Prepopulate tags if editing an assignment with existing keywords
  document.addEventListener("DOMContentLoaded", function () {
    const existingKeywords = "{{ assignment.keywords }}";
    if (existingKeywords) {
      const keywordsArray = existingKeywords.split(",");
      keywordsArray.forEach((tag) => {
        const event = new KeyboardEvent("keydown", { key: "," });
        document.getElementById("keywords-input").value = tag;
        addTag(event);
      });
    }
  });
</script>

<style>
  .tags-display {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    margin-top: 5px;
  }

  .tag {
    background-color: #e0e0e0;
    color: #333;
    padding: 5px 10px;
    border-radius: 5px;
    display: inline-flex;
    align-items: center;
    font-size: 0.9em;
  }

  .tag-delete {
    margin-left: 8px;
    color: #555;
    cursor: pointer;
  }
</style>
